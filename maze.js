const maze = [
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1],
    [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1],
    [1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1],
    [1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1],
    [1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1],
    [1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1],
    [1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1],
    [1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1],
    [1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1],
    [1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1],
    [1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1],
    [1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
    [1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1],
    [1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1],
    [1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1],
    [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2],
    
];



// ãƒ†ãƒ¼ãƒ–ãƒ«è¦ç´ å–å¾—
const table = document.getElementById("mazeTable");

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±
let player = { x: 0, y: 0, hp: 222 };

// é€šéŽæ¸ˆã¿ãƒžã‚¹ã®è¨˜éŒ²
let visited = Array(maze.length).fill().map(() => Array(maze[0].length).fill(false));

// ç§»å‹•å‡¦ç†
document.addEventListener("keydown", (event) => {
    if (!["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(event.key)) return;

    let newX = player.x;
    let newY = player.y;

    if (event.key === "ArrowUp") newX--;
    if (event.key === "ArrowDown") newX++;
    if (event.key === "ArrowLeft") newY--;
    if (event.key === "ArrowRight") newY++;

    // å£åˆ¤å®š
    if (newX >= 0 && newX < maze.length && newY >= 0 && newY < maze[0].length && maze[newX][newY] !== 1) {
        visited[player.x][player.y] = true;

        // ä½ç½®ã¨HPæ›´æ–°
        player.x = newX;
        player.y = newY;
        player.hp--;

        document.getElementById("hp").textContent = `ä½“åŠ›: ${player.hp}`;

        // ã‚´ãƒ¼ãƒ«å‡¦ç†
        if (maze[player.x][player.y] === 2) {
            alert("ãããƒƒâ€¦æ•ã¾ã£ãŸâ€¦çˆ†å¼¾ã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ‡ã‚‹é †ç•ªã¯ã€Œé’ï½¥èµ¤ï½¥èµ¤ï½¥é’ï½¥èµ¤ã€ã â€¦");

            localStorage.setItem("reportMessage", "ã€Œã‚³ãƒ¼ãƒ‰ã‚’åˆ‡ã‚‹é †ç•ªã¯â€¦é’èµ¤èµ¤é’èµ¤â€¦ã€");

            document.body.classList.add("fade-out");
            setTimeout(() => {
                window.location.href = "index.html";
            }, 1000);
            return;
        }

        // ä½“åŠ›0åˆ¤å®š
        if (player.hp <= 0) {
            alert("ä½“åŠ›ãŒãªããªã£ãŸâ€¦ çˆ†å¼¾é­”ã«é€ƒã’ã‚‰ã‚ŒãŸâ€¦ï¼ â†ºå†ãƒãƒ£ãƒ¬ãƒ³ã‚¸!");
            location.reload();
            return;
        }

        // å†æç”»
        renderMaze();
    }
});

// è¿·è·¯æç”»
function renderMaze() {
    table.innerHTML = "";
    for (let i = 0; i < maze.length; i++) {
        let row = table.insertRow();
        for (let j = 0; j < maze[i].length; j++) {
            let cell = row.insertCell();

            if (i === player.x && j === player.y) {
                cell.textContent = "ðŸ•µï¸â€â™‚ï¸";
                cell.classList.add("player");
            } else if (maze[i][j] === 1) {
                cell.textContent = " ";
                cell.classList.add("wall");
            } else if (maze[i][j] === 2) {
                cell.textContent = "ðŸ¦¹";
            } else {
                cell.textContent = " ";
            }

            if (visited[i][j]) {
                cell.classList.add("passed");
            }
        }
    }
}

// è¿·è·¯ã®åˆæœŸæç”»
renderMaze();